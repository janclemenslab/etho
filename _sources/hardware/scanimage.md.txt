# ScanImage

## ScanImage settings
- enable exterrnal triggering, leave default digital channels, set NEXT and STOP triggers to 'falling'
- Set scanimage scan dur to inf and nb acq/frames to a very large value
- Start pb_ui
- select protocol and playlist
- Focus and Start ACQ buttons will arm scanimage acquisition/focus, set the savefilename in scanimage from the datename and session number and start etho in a terminal
- Imaging will be started by a START trigger signal sent with the first sample of the first stimulus.
- Imaging data will be saved to a separate file for each stimulus, throught a NEXT trigger at the end of each Stimulus
- Imaging will stop by a STOP trigger at the end of the last stimulus or if loop or shuffle is enabled, with a delay at the end of the or via the Stop ACQ button.
- Stimuli, triggers, and pixel/scan clocks are recorded via daq

## Stimulus control
- Specify digital outputs for the triggers in the protocol: `digital_chans_out: ['port0/line1', 'port0/line2', 'port0/line3']`
- Specify the trigger output channels for each stimulus in the playlist as `SI_START`, `SI_STOP`, `SI_NEXT`. This will add start acquisition, stop acquisition and next file triggers for remote controlling scanimage to the channel digital output channels. `SI_START` will set the digital output to 1 for the first 2ms of the stimulus (starting at sample 0, _not_ at silencePre), `SI_STOP` and `SI_NEXT` will set the last 2ms (_not_ before silencePost) to 1. Scanimage should be configured for external triggering with the correct digital channels. The start trigger should be set to "rising", the stop and next triggers to "falling". See [ScanImage docs](https://docs.scanimage.org/Windows+Reference+Guide/Trigger+Controls.html) for details.
